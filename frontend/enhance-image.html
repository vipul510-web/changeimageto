<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Enhance Photo Online | Free Image Sharpener & Auto-Improve</title>
    <meta name="description" content="Enhance photos online for free: sharpen details, boost contrast and brightness. Make images look crisp and professional. No login, no watermark." />
    <meta name="keywords" content="enhance image, sharpen image, photo enhancer, increase contrast, improve brightness" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://www.changeimageto.com/enhance-image.html" />

    <meta property="og:title" content="Enhance Photo Online" />
    <meta property="og:description" content="Sharpen and improve photos instantly. Free and fast." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.changeimageto.com/enhance-image.html" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="preload" as="style" href="./styles.css?v=20250916-3" />
    <link rel="stylesheet" href="./styles.css?v=20250916-3" />

<!-- Google AI Overview tracking -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  if (window.location.hash.includes(":~:text")) {
    // Check if gtag is already available
    if (typeof gtag === "function") {
      gtag("event", "ai_overview", {
        anchor: window.location.hash
      });
    } else {
      // If gtag is not available yet, wait for it (for dynamic loading pattern)
      const checkGtag = setInterval(() => {
        if (typeof gtag === "function") {
          clearInterval(checkGtag);
          gtag("event", "ai_overview", {
            anchor: window.location.hash
          });
        }
      }, 100);
      // Stop checking after 10 seconds
      setTimeout(() => clearInterval(checkGtag), 10000);
    }
  }
});
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D3Q582VFCG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-D3Q582VFCG');
</script>
  </head>
  <body>
    <header class="container header">
      <a href="/" class="logo-link"><img src="./logo.png?v=20250916-2" alt="ChangeImageTo" class="logo-img" /></a>
      <div style="display:flex;align-items:center;gap:16px;justify-content:space-between;width:100%">
        <h1 style="margin:0">Enhance Photo Quality (Free)</h1>
        <nav class="top-nav"><a href="/blog" aria-label="Read our blog">Blog</a></nav>
      </div>
      <p>Sharpen details and auto-improve contrast/brightness to make images look crisp. No login, no watermark.</p>
    </header>

    <main class="container main">
      <form id="upload-form">
        <div class="controls">
          <div style="margin-bottom:20px">
            <label>Enhancement Presets</label>
            <select id="enhance-preset" aria-label="Enhancement Level">
              <option value="soft">Soft</option>
              <option value="balanced" selected>Balanced</option>
              <option value="strong">Strong</option>
            </select>
          </div>

          <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border,#1e2630)">
            <label style="margin-bottom:16px;display:block;font-weight:600">Advanced Controls</label>
            
            <div style="margin-bottom:16px">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                <label style="flex:0 0 140px;font-weight:400">De-blur:</label>
                <input type="checkbox" id="deblur" checked style="width:20px;height:20px;cursor:pointer">
                <span style="flex:1"></span>
              </div>
              <div style="display:flex;align-items:center;gap:12px">
                <label style="flex:0 0 140px;font-weight:400">De-blur Strength:</label>
                <input type="range" id="deblur-strength" min="0.5" max="3.0" step="0.1" value="1.5" style="flex:1">
                <input type="number" id="deblur-strength-value" min="0.5" max="3.0" step="0.1" value="1.5" style="width:80px;padding:6px;background:var(--bg,#0b0f13);border:1px solid var(--border,#1e2630);border-radius:6px;color:var(--fg,#eaf0f6)">
                <span style="flex:0 0 50px;text-align:right;color:var(--muted,#9aa7b2);font-size:14px" id="deblur-strength-display">1.5</span>
              </div>
            </div>

            <div style="margin-bottom:16px">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                <label style="flex:0 0 140px;font-weight:400">Remove Noise/Grain:</label>
                <input type="checkbox" id="denoise" checked style="width:20px;height:20px;cursor:pointer">
                <span style="flex:1"></span>
              </div>
              <div style="display:flex;align-items:center;gap:12px">
                <label style="flex:0 0 140px;font-weight:400">Denoise Strength:</label>
                <input type="range" id="denoise-strength" min="0.5" max="2.0" step="0.1" value="1.0" style="flex:1">
                <input type="number" id="denoise-strength-value" min="0.5" max="2.0" step="0.1" value="1.0" style="width:80px;padding:6px;background:var(--bg,#0b0f13);border:1px solid var(--border,#1e2630);border-radius:6px;color:var(--fg,#eaf0f6)">
                <span style="flex:0 0 50px;text-align:right;color:var(--muted,#9aa7b2);font-size:14px" id="denoise-strength-display">1.0</span>
              </div>
            </div>
          </div>
        </div>

        <div class="uploader" id="dropzone">
          <input type="file" id="file-input" accept="image/*" />
          <div class="uploader-instructions">
            <strong>Drop image here</strong>
            <span>or click to browse</span>
          </div>
        </div>

        <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
          <div style="display: flex; flex-direction: column; gap: 4px;">
            <button id="process-btn" type="submit" disabled>Enhance Image for Free</button>
            <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">Quality is not guaranteed</div>
          </div>
          <div style="display: flex; flex-direction: column; gap: 4px;">
            <button id="premium-btn" type="button" disabled style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; font-size: 14px;">
              Premium Option ($1 only per image)
            </button>
            <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">Best quality expected</div>
          </div>
        </div>
        <div id="premium-status" class="status" style="display:none; margin-top: 16px;"></div>
      </form>

      <section class="preview" id="preview-section" hidden>
        <div class="preview-grid">
          <div>
            <h3>Original</h3>
            <img id="original-img" alt="Original preview" />
          </div>
          <div>
            <h3>Enhanced</h3>
            <p id="process-prompt" class="prompt">Press "Enhance Image" to process.</p>
            <div id="result-wrapper" hidden>
              <div class="checkerboard">
                <img id="result-img" alt="Enhanced image result" />
              </div>
              <div class="actions">
                <a id="download-link" download="enhanced-image.png" class="btn">Download PNG</a>
                <button id="reset-btn" class="btn secondary" type="button">Try Another Image</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="seo">
        <h2>How to enhance image quality</h2>
        <ol>
          <li>Upload your photo above.</li>
          <li>Choose an <strong>Enhancement Preset</strong> (Soft, Balanced, or Strong) for the free option, or use <strong>Premium</strong> for AI-powered enhancement.</li>
          <li>Click <strong>Enhance Image for Free</strong> for basic quality improvements, or <strong>Premium Option</strong> for best quality results using Google Gemini AI.</li>
          <li>We automatically sharpen details, reduce noise, fix blur, enhance colors and contrast.</li>
          <li>Download your improved image as PNG.</li>
        </ol>

        <h3>Free vs Premium Enhancement</h3>
        <ul>
          <li><strong>Free Enhancement:</strong> Uses traditional image processing techniques (sharpening, contrast, brightness adjustments). Good for quick improvements. Quality may vary.</li>
          <li><strong>Premium Enhancement ($1 per image):</strong> Powered by Google Gemini AI, intelligently improves clarity, reduces noise, fixes artifacts, and enhances overall image quality while maintaining natural appearance. Best quality guaranteed.</li>
        </ul>

        <h3>When to enhance an image</h3>
        <ul>
          <li><strong>Low-light photos:</strong> Recover clarity and reduce noise with AI-powered enhancement. Premium option recommended for best results.</li>
          <li><strong>Social posts:</strong> Make images pop with clean detail. Both free and premium options work well.</li>
          <li><strong>Product photos:</strong> Improve perceived quality without reshooting. <a href="/enhance-image-for-ecommerce.html">Learn more about enhancing images for ecommerce</a>. Premium option recommended for professional results.</li>
          <li><strong>Old or damaged photos:</strong> Restore faded colors and fix artifacts. Premium AI enhancement excels at restoring historical or damaged images.</li>
          <li><strong>Blurry images:</strong> Sharpen details and fix blur. Premium option uses advanced AI algorithms for superior de-blurring.</li>
        </ul>
       
        <p>Tip: Use <strong>Balanced</strong> preset for most free enhancements. Pick <strong>Soft</strong> for faces; <strong>Strong</strong> for text or graphics. For best quality results on important images, choose the <strong>Premium Option</strong> powered by Google Gemini AI.</p>
      </section>
    </main>

    <!-- FAQ Section -->
    <section class="container faq-section" style="margin-top: 40px; padding: 40px 0;">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-list" style="margin-top: 20px;">
        <div class="faq-item" style="margin-bottom: 20px;">
          <h3>How do I enhance an image?</h3>
          <p>Upload your image, choose enhancement presets (Soft, Balanced, or Strong), adjust deblur and denoise settings if needed, then click "Enhance Image for Free" or use the Premium option for best quality. Our AI will improve sharpness, contrast, and overall image quality.</p>
        </div>
        <div class="faq-item" style="margin-bottom: 20px;">
          <h3>What's the difference between free and premium enhancement?</h3>
          <p>The free option provides basic enhancement with quality not guaranteed. The premium option ($1 per image) uses Google Gemini AI for best quality results with advanced sharpening, contrast adjustment, and noise reduction.</p>
        </div>
        <div class="faq-item" style="margin-bottom: 20px;">
          <h3>What enhancement presets should I use?</h3>
          <p>Use "Soft" for subtle improvements, "Balanced" for general enhancement, or "Strong" for maximum sharpness and contrast. You can also adjust deblur and denoise strength manually for fine-tuning.</p>
        </div>
        <div class="faq-item" style="margin-bottom: 20px;">
          <h3>What image formats are supported?</h3>
          <p>We support all major image formats including JPG, PNG, and other common formats. Upload your image and get enhanced results instantly.</p>
        </div>
        <div class="faq-item" style="margin-bottom: 20px;">
          <h3>Can I enhance low-resolution images?</h3>
          <p>Yes, our enhancement tool can improve low-resolution images by sharpening details and reducing noise. For best results with very low-resolution images, consider using our <a href="/upscale-image.html">Upscale Image</a> tool first, then enhance the upscaled image.</p>
        </div>
      </div>
    </section>

    <nav class="seo-links">
      <a href="/remove-background-from-image.html">Remove Background from Image</a>
      <a href="/change-color-of-image.html">Change color of image online</a>
      <a href="/change-image-background.html">Change image background</a>
      <a href="/convert-image-format.html">Convert image format</a>
      <a href="/upscale-image.html">AI Image Upscaler</a>
      <a href="/blur-background.html">Blur Background</a>
      <a href="/add-text-to-photo.html">Add Text to Photo</a>
      <a href="/enhance-image.html">Enhance Image</a>
    </nav>

    <footer class="comprehensive-footer">
      <div class="container">
        <div class="footer-grid">
          <!-- Brand Section -->
          <div class="footer-brand">
            <div class="footer-logo">
              <img src="/logo.png?v=20250921-1" alt="ChangeImageTo" style="height: 32px; margin-bottom: 16px;">
            </div>
            <p class="footer-description">
              The leading platform for free online image editing. Remove backgrounds, change colors, resize images, and enhance photos instantly with AI-powered tools.
            </p>
            <div class="footer-social">
              <a href="https://x.com/vipulawl" aria-label="Follow us on Twitter" class="social-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              </a>
              <a href="https://www.youtube.com/@changeimageto" aria-label="Subscribe on YouTube" class="social-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
              </a>
              <a href="https://linkedin.com/company/make-a-video/" aria-label="Connect on LinkedIn" class="social-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
            </div>
          </div>

          <!-- Tools Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Image Tools</h3>
            <ul class="footer-links">
              <li><a href="/remove-background-from-image.html">Remove Background</a></li>
              <li><a href="/change-image-background.html">Change Background</a></li>
              <li><a href="/change-color-of-image.html">Change Image Colors</a></li>
              <li><a href="/upscale-image.html">Upscale Image</a></li>
              <li><a href="/enhance-image.html">Enhance Image</a></li>
              <li><a href="/blur-background.html">Blur Background</a></li>
              <li><a href="/add-text-to-photo.html">Add Text to Photo</a></li>
              <li><a href="/convert-image-format.html">Convert Image Format</a></li>
              <li><a href="/remove-people-from-photo.html">Remove People / Objects</a></li>
              <li><a href="/remove-text-from-image.html">Remove Text / Watermark</a></li>
              <li><a href="/bulk-image-resizer.html">Bulk Image Resizer</a></li>
              <li><a href="/image-quality-checker.html">Image Quality Checker</a></li>
              <li><a href="/real-estate-photo-enhancement.html">Real Estate Photo Enhancement</a></li>
            </ul>
          </div>

          <!-- Blog Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Latest Blog Posts</h3>
            <ul class="footer-links">
              <li><a href="/blog/remove-background-from-image.html">Remove Background from Image</a></li>
              <li><a href="/blog/upscale-image.html">Upscale Image Quality</a></li>
              <li><a href="/blog/change-image-background-color.html">Change Image Background Color</a></li>
              <li><a href="/blog/remove-background-from-image-photoshop.html">Remove Background in Photoshop</a></li>
              <li><a href="/blog/change-image-background-color-online.html">Change Background Color Online</a></li>
              <li><a href="/blog/remove-background-from-image-canva.html">Remove Background in Canva</a></li>
              <li><a href="/blog/change-image-background-color-photoshop.html">Change Background in Photoshop</a></li>
              <li><a href="/blog/remove-background-from-image-android.html">Remove Background on Android</a></li>
            </ul>
          </div>

          <!-- Alternatives Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Tool Alternatives</h3>
            <ul class="footer-links">
              <li><a href="/blog/photopea-vs-canva.html">Photopea vs Canva</a></li>
              <li><a href="/blog/capcut-vs-davinci-resolve.html">CapCut vs DaVinci Resolve</a></li>
              <li><a href="/blog/canva-vs-photopea.html">Canva vs Photopea</a></li>
              <li><a href="/blog/free-photoshop-alternatives.html">Free Photoshop Alternatives</a></li>
              <li><a href="/blog/ai-background-removers.html">AI Background Removers</a></li>
            </ul>
          </div>

          <!-- Company Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Company</h3>
            <ul class="footer-links">
              <li><a href="/privacy-policy.html">Privacy Policy</a></li>
              <li><a href="/contact.html">Contact Us</a></li>
              <li><a href="/about.html">About</a></li>
            </ul>
          </div>
        </div>

        <!-- Bottom Bar -->
        <div class="footer-bottom">
          <div class="footer-bottom-content">
            <p class="footer-copyright">
              Â© 2024 ChangeImageTo.com. All rights reserved. Built for speed and quality.
            </p>
            <div class="footer-bottom-links">
              <a href="/privacy-policy.html">Privacy</a>
              <a href="#terms">Terms</a>
              <a href="#cookies">Cookies</a>
              <a href="#security">Security</a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="./script.js?v=20251220-1" defer></script>
    
    <style>
      #premium-status {
        padding: 12px 16px;
        border-radius: 8px;
        margin-top: 16px;
        display: none;
      }
      #premium-status.status {
        background: #f0f0f0;
        color: #333;
      }
      #premium-status.status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      #premium-status.status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      #premium-status.status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      #premium-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
    </style>
    
    <script>
      // Premium option functionality
      (function() {
        const premiumBtn = document.getElementById('premium-btn');
        const fileInput = document.getElementById('file-input');
        const dropzone = document.getElementById('dropzone');
        const premiumStatusDiv = document.getElementById('premium-status');
        const originalImg = document.getElementById('original-img');
        const resultImg = document.getElementById('result-img');
        const resultWrapper = document.getElementById('result-wrapper');
        const processPrompt = document.getElementById('process-prompt');
        const downloadLink = document.getElementById('download-link');
        const previewSection = document.getElementById('preview-section');
        
        let currentFile = null;
        let paymentSessionId = null;
        let hasProcessed = false;
        
        // Determine API base URL (production vs local)
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const API_BASE = isLocal ? 'http://127.0.0.1:8000' : 'https://bgremover-backend-121350814881.us-central1.run.app';
        
        function showPremiumStatus(message, type = 'info') {
          premiumStatusDiv.textContent = message;
          premiumStatusDiv.className = `status ${type}`;
          premiumStatusDiv.style.display = 'block';
        }
        
        function hidePremiumStatus() {
          premiumStatusDiv.style.display = 'none';
        }
        
        // Enable premium button when file is selected (hook into existing file input handler)
        // Use a MutationObserver or event delegation to detect when file is selected
        // Since script.js already handles file input changes, we'll also listen for it
        const checkFileAndEnablePremium = () => {
          // Check if file input has a file
          if (fileInput && fileInput.files && fileInput.files[0]) {
            currentFile = fileInput.files[0];
            if (premiumBtn) premiumBtn.disabled = false;
            // Reset premium state when new file is uploaded
            paymentSessionId = null;
            hasProcessed = false;
          }
        };
        
        // Listen for file input changes
        if (fileInput) {
          fileInput.addEventListener('change', (e) => {
            checkFileAndEnablePremium();
          });
        }
        
        // Also listen for delegated change events (script.js uses this)
        document.addEventListener('change', (e) => {
          if (e.target && e.target.id === 'file-input' && e.target.files && e.target.files[0]) {
            checkFileAndEnablePremium();
          }
        });
        
        // Hook into dropzone drop event
        if (dropzone) {
          dropzone.addEventListener('drop', (e) => {
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
              currentFile = file;
              if (premiumBtn) premiumBtn.disabled = false;
              // Reset premium state when new file is uploaded
              paymentSessionId = null;
              hasProcessed = false;
            }
          });
        }
        
        // Store file data before payment redirect
        function storePendingFile(file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            sessionStorage.setItem('premiumEnhancePendingImageData', e.target.result);
            sessionStorage.setItem('premiumEnhancePendingImageName', file.name);
            sessionStorage.setItem('premiumEnhancePendingImageType', file.type);
          };
          reader.readAsDataURL(file);
        }
        
        // Restore file after payment redirect
        function restorePremiumPendingFile() {
          const imageData = sessionStorage.getItem('premiumEnhancePendingImageData');
          const imageName = sessionStorage.getItem('premiumEnhancePendingImageName');
          const imageType = sessionStorage.getItem('premiumEnhancePendingImageType');
          
          if (imageData && imageName && imageType) {
            fetch(imageData)
              .then(res => res.blob())
              .then(blob => {
                const file = new File([blob], imageName, { type: imageType });
                currentFile = file;
                if (originalImg) originalImg.src = imageData;
                if (previewSection) previewSection.hidden = false;
                
                // Auto-process after file restoration
                if (paymentSessionId) {
                  setTimeout(() => {
                    processPremiumImage();
                  }, 500);
                }
              })
              .catch(err => {
                console.error('Error restoring file:', err);
                showPremiumStatus('Error restoring image. Please upload again.', 'error');
              });
          }
        }
        
        // Handle premium button click - create payment
        if (premiumBtn) {
          premiumBtn.addEventListener('click', async () => {
            if (!currentFile) return;
            
            // Track Premium button click in Google Analytics
            window.dataLayer = window.dataLayer || [];
            if (typeof gtag === 'function') {
              gtag('event', 'premium_button_click', {
                event_category: 'engagement',
                event_label: 'premium_image_enhancement',
                page_path: window.location.pathname,
                page_title: document.title,
                value: 1
              });
            } else {
              // Fallback to dataLayer if gtag not available yet
              window.dataLayer.push({
                'event': 'premium_button_click',
                'event_category': 'engagement',
                'event_label': 'premium_image_enhancement',
                'page_path': window.location.pathname,
                'page_title': document.title,
                'value': 1
              });
            }
            
            premiumBtn.disabled = true;
            premiumBtn.textContent = 'Creating checkout...';
            showPremiumStatus('Creating payment checkout...', 'info');
            
            // Store file before redirect
            storePendingFile(currentFile);
            
            try {
              const returnUrl = window.location.href.split('?')[0];
              const checkoutResponse = await fetch(`${API_BASE}/api/create-payment-checkout`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  return_url: returnUrl
                })
              });
              
              if (!checkoutResponse.ok) {
                const errorText = await checkoutResponse.text();
                throw new Error(`HTTP ${checkoutResponse.status}: ${errorText}`);
              }
              
              const checkoutData = await checkoutResponse.json();
              paymentSessionId = checkoutData.session_id;
              
              // Redirect to checkout
              window.location.href = checkoutData.checkout_url;
              
            } catch (error) {
              console.error('Error:', error);
              showPremiumStatus('Error: ' + error.message, 'error');
              premiumBtn.disabled = false;
              premiumBtn.textContent = 'Premium Option ($1 only per image)';
            }
          });
        }
        
        // Process image with Google Gemini after payment
        async function processPremiumImage() {
          if (!currentFile || !paymentSessionId) {
            showPremiumStatus('Please complete payment first', 'error');
            return;
          }
          
          if (hasProcessed) {
            showPremiumStatus('This payment has already been used. Please pay again to process another image.', 'error');
            return;
          }
          
          if (premiumBtn) {
            premiumBtn.disabled = true;
            premiumBtn.textContent = 'Processing...';
          }
          showPremiumStatus('Processing with Premium AI...', 'info');
          
          try {
            const formData = new FormData();
            formData.append('file', currentFile);
            formData.append('payment_session_id', paymentSessionId);
            
            const response = await fetch(`${API_BASE}/api/test-google-enhance-payment`, {
              method: 'POST',
              body: formData
            });
            
            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(`HTTP ${response.status}: ${errorText}`);
            }
            
            const blob = await response.blob();
            const url = URL.createObjectURL(blob);
            
            // Show result
            if (resultImg) resultImg.src = url;
            if (processPrompt) processPrompt.style.display = 'none';
            if (resultWrapper) resultWrapper.hidden = false;
            if (previewSection) previewSection.hidden = false;
            
            // Remove checkerboard padding/background for premium result
            const checkerboard = resultWrapper ? resultWrapper.querySelector('.checkerboard') : null;
            if (checkerboard) {
              checkerboard.style.padding = '0';
              checkerboard.style.background = 'none';
              checkerboard.style.minHeight = 'auto';
              checkerboard.style.display = 'block';
            }
            
            if (downloadLink) {
              downloadLink.href = url;
              downloadLink.download = `premium-enhanced-${Date.now()}.png`;
            }
            
            showPremiumStatus('Premium image enhancement successful!', 'success');
            hasProcessed = true;
            if (premiumBtn) {
              premiumBtn.disabled = true;
              premiumBtn.textContent = 'Processing Complete';
            }
            
          } catch (error) {
            console.error('Error:', error);
            showPremiumStatus('Error: ' + error.message, 'error');
            
            // Reset state if payment session error
            if (error.message.includes('already been used') || error.message.includes('403')) {
              paymentSessionId = null;
              hasProcessed = false;
              if (premiumBtn) {
                premiumBtn.disabled = false;
                premiumBtn.textContent = 'Premium Option ($1 only per image)';
              }
            }
          }
        }
        
        // Check for payment success on page load (returning from checkout)
        window.addEventListener('load', () => {
          const urlParams = new URLSearchParams(window.location.search);
          const paymentStatus = urlParams.get('status');
          const sessionId = urlParams.get('session_id');
          
          if (paymentStatus === 'succeeded' && sessionId) {
            paymentSessionId = sessionId;
            restorePremiumPendingFile();
          }
        });
      })();
      
      // Sync sliders with number inputs for advanced controls
      document.addEventListener('DOMContentLoaded', function() {
        function syncControls() {
          const controls = [
            { slider: 'deblur-strength', number: 'deblur-strength-value', display: 'deblur-strength-display', format: v => v.toFixed(1) },
            { slider: 'denoise-strength', number: 'denoise-strength-value', display: 'denoise-strength-display', format: v => v.toFixed(1) }
          ];

          controls.forEach(({ slider, number, display, format }) => {
            const sliderEl = document.getElementById(slider);
            const numberEl = document.getElementById(number);
            const displayEl = document.getElementById(display);

            if (sliderEl && numberEl && displayEl) {
              sliderEl.addEventListener('input', function() {
                const val = parseFloat(this.value);
                numberEl.value = val;
                displayEl.textContent = format(val);
              });

              numberEl.addEventListener('input', function() {
                const val = parseFloat(this.value);
                sliderEl.value = val;
                displayEl.textContent = format(val);
              });
            }
          });
        }
        syncControls();
      });
    </script>
  </body>
</html>


