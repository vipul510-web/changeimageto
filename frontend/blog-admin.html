<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Management - Admin Panel</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .admin-tab {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .admin-tab.active {
            background: #667eea;
            color: white;
        }
        
        .admin-tab:hover {
            background: #e0e0e0;
        }
        
        .admin-tab.active:hover {
            background: #5a6fd8;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .draft-card, .post-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .draft-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .draft-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .draft-meta {
            color: #666;
            font-size: 0.9em;
            margin: 5px 0;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .status-draft { background: #fff3cd; color: #856404; }
        .status-pending { background: #d1ecf1; color: #0c5460; }
        .status-approved { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .status-published { background: #d1ecf1; color: #0c5460; }
        
        .draft-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-edit { background: #17a2b8; color: white; }
        .btn-approve { background: #28a745; color: white; }
        .btn-reject { background: #dc3545; color: white; }
        .btn-publish { background: #007bff; color: white; }
        .btn-preview { background: #6c757d; color: white; }
        
        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 1000;
        }
        
        .editor-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .editor-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .close-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-textarea {
            height: 300px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }
        
        .editor-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .editor-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .editor-tab {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .editor-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .visual-editor {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            min-height: 400px;
            background: white;
        }
        
        .editor-toolbar {
            display: flex;
            gap: 5px;
            padding: 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            border-radius: 8px 8px 0 0;
        }
        
        .editor-toolbar button {
            padding: 6px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }
        
        .editor-toolbar button:hover {
            background: #e9ecef;
            border-color: #667eea;
        }
        
        .editor-toolbar button:active {
            background: #667eea;
            color: white;
        }
        
        .content-editor {
            padding: 20px;
            min-height: 400px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            outline: none;
        }
        
        .content-editor h1, .content-editor h2, .content-editor h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .content-editor h1 { font-size: 1.8em; }
        .content-editor h2 { font-size: 1.4em; }
        .content-editor h3 { font-size: 1.2em; }
        
        .content-editor p {
            margin-bottom: 15px;
        }
        
        .content-editor ul, .content-editor ol {
            margin-bottom: 15px;
            padding-left: 20px;
        }
        
        .content-editor a {
            color: #667eea;
            text-decoration: underline;
        }
        
        .content-editor strong {
            font-weight: 600;
        }
        
        .content-editor:focus {
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>📝 Blog Management</h1>
            <p>Review, edit, and approve blog posts before they go live</p>
        </div>
        
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="drafts">Drafts & Pending</button>
            <button class="admin-tab" data-tab="published">Published Posts</button>
            <button class="admin-tab" data-tab="stats">Statistics</button>
        </div>
        
        <!-- Drafts Tab -->
        <div id="drafts-tab" class="tab-content active">
            <button class="generate-btn" onclick="generateDrafts()">
                🚀 Generate New Drafts
            </button>
            
            <div id="drafts-container">
                <div class="loading">Loading drafts...</div>
            </div>
        </div>
        
        <!-- Published Tab -->
        <div id="published-tab" class="tab-content">
            <div id="published-container">
                <div class="loading">Loading published posts...</div>
            </div>
        </div>
        
        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-drafts">0</div>
                    <div class="stat-label">Draft Posts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-published">0</div>
                    <div class="stat-label">Published Posts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-pending">0</div>
                    <div class="stat-label">Pending Approval</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-rejected">0</div>
                    <div class="stat-label">Rejected Posts</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Editor Modal -->
    <div id="editor-modal" class="editor-modal">
        <div class="editor-content">
            <div class="editor-header">
                <h2 class="editor-title">Edit Blog Post</h2>
                <button class="close-btn" onclick="closeEditor()">&times;</button>
            </div>
            
            <form id="editor-form">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" id="edit-title" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Content</label>
                    <div class="editor-tabs">
                        <button type="button" class="editor-tab active" onclick="switchEditorTab('visual')">Visual Editor</button>
                        <button type="button" class="editor-tab" onclick="switchEditorTab('html')">HTML Source</button>
                    </div>
                    <div id="visual-editor" class="visual-editor">
                        <div class="editor-toolbar">
                            <button type="button" onclick="formatText('bold')" title="Bold"><b>B</b></button>
                            <button type="button" onclick="formatText('italic')" title="Italic"><i>I</i></button>
                            <button type="button" onclick="formatText('underline')" title="Underline"><u>U</u></button>
                            <button type="button" onclick="insertHeading('h2')" title="Heading 2">H2</button>
                            <button type="button" onclick="insertHeading('h3')" title="Heading 3">H3</button>
                            <button type="button" onclick="insertList('ul')" title="Bullet List">• List</button>
                            <button type="button" onclick="insertList('ol')" title="Numbered List">1. List</button>
                            <button type="button" onclick="insertLink()" title="Insert Link">🔗 Link</button>
                        </div>
                        <div id="content-editor" contenteditable="true" class="content-editor"></div>
                    </div>
                    <textarea id="edit-content" class="form-textarea" style="display:none;" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea id="edit-notes" class="form-textarea" rows="3"></textarea>
                </div>
                
                <div class="editor-actions">
                    <button type="button" class="btn-small btn-preview" onclick="previewPost()">Preview</button>
                    <button type="button" class="btn-small btn-reject" onclick="rejectPost()">Reject</button>
                    <button type="button" class="btn-small btn-approve" onclick="approvePost()">Approve</button>
                    <button type="submit" class="btn-small btn-edit">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Preview Modal -->
    <div id="preview-modal" class="editor-modal">
        <div class="editor-content">
            <div class="editor-header">
                <h2 class="editor-title">Post Preview</h2>
                <button class="close-btn" onclick="closePreview()">&times;</button>
            </div>
            <div id="preview-content"></div>
        </div>
    </div>

    <script>
        let currentPost = null;
        let drafts = [];
        let published = [];
        let currentEditorMode = 'visual';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadDrafts();
            loadPublished();
            setupTabs();
        });
        
        function switchEditorTab(mode) {
            const visualTab = document.querySelector('.editor-tab[onclick*="visual"]');
            const htmlTab = document.querySelector('.editor-tab[onclick*="html"]');
            const visualEditor = document.getElementById('visual-editor');
            const htmlEditor = document.getElementById('edit-content');
            
            if (mode === 'visual') {
                visualTab.classList.add('active');
                htmlTab.classList.remove('active');
                visualEditor.style.display = 'block';
                htmlEditor.style.display = 'none';
                currentEditorMode = 'visual';
                
                // Sync content from HTML to visual editor
                if (currentPost) {
                    syncHtmlToVisual();
                }
            } else {
                visualTab.classList.remove('active');
                htmlTab.classList.add('active');
                visualEditor.style.display = 'none';
                htmlEditor.style.display = 'block';
                currentEditorMode = 'html';
                
                // Sync content from visual to HTML editor
                syncVisualToHtml();
            }
        }
        
        function extractContentFromHtml(html) {
            // Extract just the main content from the full HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const main = doc.querySelector('main.container.main');
            
            if (main) {
                // Remove the header info and footer links
                const headerInfo = main.querySelector('p[style*="margin:0 0 16px"]');
                const footerLink = main.querySelector('p[style*="margin-top:24px"]');
                const seoLinks = doc.querySelector('nav.seo-links');
                
                if (headerInfo) headerInfo.remove();
                if (footerLink) footerLink.remove();
                if (seoLinks) seoLinks.remove();
                
                return main.innerHTML;
            }
            
            return html;
        }
        
        function syncHtmlToVisual() {
            const htmlContent = document.getElementById('edit-content').value;
            const contentEditor = document.getElementById('content-editor');
            const extractedContent = extractContentFromHtml(htmlContent);
            contentEditor.innerHTML = extractedContent;
        }
        
        function syncVisualToHtml() {
            const contentEditor = document.getElementById('content-editor');
            const htmlEditor = document.getElementById('edit-content');
            const visualContent = contentEditor.innerHTML;
            
            // Get the original HTML structure and replace just the main content
            const originalHtml = document.getElementById('edit-content').value;
            const parser = new DOMParser();
            const doc = parser.parseFromString(originalHtml, 'text/html');
            const main = doc.querySelector('main.container.main');
            
            if (main) {
                // Keep the header info and footer link, replace the rest
                const headerInfo = main.querySelector('p[style*="margin:0 0 16px"]');
                const footerLink = main.querySelector('p[style*="margin-top:24px"]');
                
                // Clear main content
                main.innerHTML = '';
                
                // Add back header info
                if (headerInfo) {
                    main.appendChild(headerInfo);
                }
                
                // Add the new content
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = visualContent;
                while (tempDiv.firstChild) {
                    main.appendChild(tempDiv.firstChild);
                }
                
                // Add back footer link
                if (footerLink) {
                    main.appendChild(footerLink);
                }
                
                htmlEditor.value = doc.documentElement.outerHTML;
            } else {
                htmlEditor.value = originalHtml;
            }
        }
        
        function setupTabs() {
            const tabs = document.querySelectorAll('.admin-tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    tab.classList.add('active');
                    const tabId = tab.dataset.tab;
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Load data for active tab
                    if (tabId === 'stats') {
                        updateStats();
                    }
                });
            });
        }
        
        async function loadDrafts() {
            try {
                const response = await fetch('/api/blog/admin/drafts');
                const data = await response.json();
                drafts = data.drafts;
                renderDrafts();
            } catch (error) {
                console.error('Error loading drafts:', error);
                document.getElementById('drafts-container').innerHTML = 
                    '<div class="empty-state"><h3>Error loading drafts</h3><p>Please try again later.</p></div>';
            }
        }
        
        async function loadPublished() {
            try {
                const response = await fetch('/api/blog/admin/published');
                const data = await response.json();
                published = data.posts;
                renderPublished();
            } catch (error) {
                console.error('Error loading published posts:', error);
                document.getElementById('published-container').innerHTML = 
                    '<div class="empty-state"><h3>Error loading published posts</h3><p>Please try again later.</p></div>';
            }
        }
        
        function renderDrafts() {
            const container = document.getElementById('drafts-container');
            
            if (drafts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No drafts available</h3>
                        <p>Click "Generate New Drafts" to create new blog posts for review.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = drafts.map(draft => `
                <div class="draft-card">
                    <div class="draft-header">
                        <div>
                            <h3 class="draft-title">${draft.title}</h3>
                            <div class="draft-meta">
                                Slug: ${draft.slug} | 
                                Created: ${new Date(draft.created_at).toLocaleDateString()} |
                                Updated: ${new Date(draft.updated_at).toLocaleDateString()}
                            </div>
                            ${draft.notes ? `<div class="draft-meta">Notes: ${draft.notes}</div>` : ''}
                        </div>
                        <span class="status-badge status-${draft.status}">${draft.status}</span>
                    </div>
                    
                    <div class="draft-actions">
                        <button class="btn-small btn-edit" onclick="editPost(${draft.id})">Edit</button>
                        <button class="btn-small btn-preview" onclick="previewDraft(${draft.id})">Preview</button>
                        ${draft.status === 'draft' || draft.status === 'rejected' ? 
                            `<button class="btn-small btn-approve" onclick="approvePost(${draft.id})">Approve</button>` : ''}
                        ${draft.status === 'approved' ? 
                            `<button class="btn-small btn-publish" onclick="publishPost(${draft.id})">Publish</button>` : ''}
                        ${draft.status !== 'rejected' ? 
                            `<button class="btn-small btn-reject" onclick="rejectPost(${draft.id})">Reject</button>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function renderPublished() {
            const container = document.getElementById('published-container');
            
            if (published.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No published posts</h3>
                        <p>Approved posts will appear here once they are published.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = published.map(post => `
                <div class="post-card">
                    <div class="draft-header">
                        <div>
                            <h3 class="draft-title">${post.title}</h3>
                            <div class="draft-meta">
                                Slug: ${post.slug} | 
                                Published: ${new Date(post.published_at).toLocaleDateString()} |
                                Author: ${post.author}
                            </div>
                        </div>
                        <span class="status-badge status-published">Published</span>
                    </div>
                    
                    <div class="draft-actions">
                        <button class="btn-small btn-preview" onclick="viewPublishedPost('${post.slug}')">View Live</button>
                    </div>
                </div>
            `).join('');
        }
        
        function updateStats() {
            document.getElementById('total-drafts').textContent = 
                drafts.filter(d => d.status === 'draft').length;
            document.getElementById('total-published').textContent = published.length;
            document.getElementById('total-pending').textContent = 
                drafts.filter(d => d.status === 'pending_approval').length;
            document.getElementById('total-rejected').textContent = 
                drafts.filter(d => d.status === 'rejected').length;
        }
        
        async function generateDrafts() {
            const button = document.querySelector('.generate-btn');
            const originalText = button.textContent;
            button.textContent = 'Generating...';
            button.disabled = true;
            
            try {
                const response = await fetch('/api/blog/admin/generate-draft', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    alert('New drafts generated successfully!');
                    loadDrafts();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to generate drafts');
                }
            } catch (error) {
                console.error('Error generating drafts:', error);
                alert('Error generating drafts: ' + error.message);
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        async function editPost(postId) {
            try {
                const response = await fetch(`/api/blog/admin/post/${postId}`);
                const post = await response.json();
                
                currentPost = post;
                document.getElementById('edit-title').value = post.title;
                document.getElementById('edit-content').value = post.content;
                document.getElementById('edit-notes').value = post.notes || '';
                
                // Initialize visual editor with content
                syncHtmlToVisual();
                
                document.getElementById('editor-modal').style.display = 'block';
            } catch (error) {
                console.error('Error loading post:', error);
                alert('Error loading post for editing.');
            }
        }
        
        async function savePost() {
            if (!currentPost) return;
            
            try {
                // Sync visual editor content to HTML if in visual mode
                if (currentEditorMode === 'visual') {
                    syncVisualToHtml();
                }
                
                const response = await fetch(`/api/blog/admin/post/${currentPost.id}/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: document.getElementById('edit-title').value,
                        content: document.getElementById('edit-content').value,
                        notes: document.getElementById('edit-notes').value
                    })
                });
                
                if (response.ok) {
                    alert('Post updated successfully!');
                    closeEditor();
                    loadDrafts();
                } else {
                    throw new Error('Failed to update post');
                }
            } catch (error) {
                console.error('Error updating post:', error);
                alert('Error updating post. Please try again.');
            }
        }
        
        async function approvePost(postId) {
            if (!confirm('Are you sure you want to approve this post?')) return;
            
            try {
                const response = await fetch(`/api/blog/admin/post/${postId}/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        approver: 'admin',
                        notes: 'Approved for publishing'
                    })
                });
                
                if (response.ok) {
                    alert('Post approved successfully!');
                    loadDrafts();
                } else {
                    throw new Error('Failed to approve post');
                }
            } catch (error) {
                console.error('Error approving post:', error);
                alert('Error approving post. Please try again.');
            }
        }
        
        async function rejectPost(postId) {
            const reason = prompt('Please provide a reason for rejection:');
            if (!reason) return;
            
            try {
                const response = await fetch(`/api/blog/admin/post/${postId}/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        approver: 'admin',
                        notes: reason
                    })
                });
                
                if (response.ok) {
                    alert('Post rejected.');
                    loadDrafts();
                } else {
                    throw new Error('Failed to reject post');
                }
            } catch (error) {
                console.error('Error rejecting post:', error);
                alert('Error rejecting post. Please try again.');
            }
        }
        
        async function publishPost(postId) {
            if (!confirm('Are you sure you want to publish this post to the live site?')) return;
            
            try {
                const response = await fetch(`/api/blog/admin/post/${postId}/publish`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    alert('Post published successfully!');
                    loadDrafts();
                    loadPublished();
                } else {
                    throw new Error('Failed to publish post');
                }
            } catch (error) {
                console.error('Error publishing post:', error);
                alert('Error publishing post. Please try again.');
            }
        }
        
        function previewPost() {
            const content = document.getElementById('edit-content').value;
            document.getElementById('preview-content').innerHTML = content;
            document.getElementById('preview-modal').style.display = 'block';
        }
        
        function closeEditor() {
            document.getElementById('editor-modal').style.display = 'none';
            currentPost = null;
        }
        
        function closePreview() {
            document.getElementById('preview-modal').style.display = 'none';
        }
        
        function viewPublishedPost(slug) {
            window.open(`/blog/${slug}.html`, '_blank');
        }
        
        // Formatting functions for visual editor
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('content-editor').focus();
        }
        
        function insertHeading(tag) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const heading = document.createElement(tag);
                heading.textContent = 'New Heading';
                range.deleteContents();
                range.insertNode(heading);
                
                // Select the heading text for easy editing
                const newRange = document.createRange();
                newRange.selectNodeContents(heading);
                selection.removeAllRanges();
                selection.addRange(newRange);
            }
            document.getElementById('content-editor').focus();
        }
        
        function insertList(type) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const list = document.createElement(type);
                const item = document.createElement('li');
                item.textContent = 'List item';
                list.appendChild(item);
                range.deleteContents();
                range.insertNode(list);
            }
            document.getElementById('content-editor').focus();
        }
        
        function insertLink() {
            const url = prompt('Enter URL:');
            if (url) {
                document.execCommand('createLink', false, url);
            }
            document.getElementById('content-editor').focus();
        }
        
        // Form submission
        document.getElementById('editor-form').addEventListener('submit', function(e) {
            e.preventDefault();
            savePost();
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('editor-modal')) {
                closeEditor();
                closePreview();
            }
        });
    </script>
    <footer class="comprehensive-footer">
      <div class="container">
        <div class="footer-grid">
          <!-- Brand Section -->
          <div class="footer-brand">
            <div class="footer-logo">
              <img src="/logo.png?v=20250921-1" alt="ChangeImageTo" style="height: 32px; margin-bottom: 16px;">
            </div>
            <p class="footer-description">
              The leading platform for free online image editing. Remove backgrounds, change colors, resize images, and enhance photos instantly with AI-powered tools.
            </p>
            <div class="footer-social">
              <a href="https://x.com/vipulawl" aria-label="Follow us on Twitter" class="social-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              </a>
              <a href="https://www.youtube.com/@changeimageto" aria-label="Subscribe on YouTube" class="social-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
              </a>
              <a href="https://linkedin.com/company/make-a-video/" aria-label="Connect on LinkedIn" class="social-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
            </div>
          </div>

          <!-- Tools Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Image Tools</h3>
            <ul class="footer-links">
              <li><a href="/remove-background-from-image.html">Remove Background</a></li>
              <li><a href="/change-image-background.html">Change Background</a></li>
              <li><a href="/change-color-of-image.html">Change Image Colors</a></li>
              <li><a href="/upscale-image.html">Upscale Image</a></li>
              <li><a href="/enhance-image.html">Enhance Image</a></li>
              <li><a href="/blur-background.html">Blur Background</a></li>
            </ul>
          </div>

          <!-- Blog Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Latest Blog Posts</h3>
            <ul class="footer-links">
              <li><a href="/blog/remove-background-from-image.html">Remove Background from Image</a></li>
              <li><a href="/blog/upscale-image.html">Upscale Image Quality</a></li>
              <li><a href="/blog/change-image-background-color.html">Change Image Background Color</a></li>
              <li><a href="/blog/remove-background-from-image-photoshop.html">Remove Background in Photoshop</a></li>
              <li><a href="/blog/change-image-background-color-online.html">Change Background Color Online</a></li>
              <li><a href="/blog/remove-background-from-image-canva.html">Remove Background in Canva</a></li>
              <li><a href="/blog/change-image-background-color-photoshop.html">Change Background in Photoshop</a></li>
              <li><a href="/blog/remove-background-from-image-android.html">Remove Background on Android</a></li>
            </ul>
          </div>

          <!-- Alternatives Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Tool Alternatives</h3>
            <ul class="footer-links">
              <li><a href="/blog/photopea-vs-canva.html">Photopea vs Canva</a></li>
              <li><a href="/blog/capcut-vs-davinci-resolve.html">CapCut vs DaVinci Resolve</a></li>
              <li><a href="/blog/canva-vs-photopea.html">Canva vs Photopea</a></li>
              <li><a href="/blog/free-photoshop-alternatives.html">Free Photoshop Alternatives</a></li>
              <li><a href="/blog/ai-background-removers.html">AI Background Removers</a></li>
            </ul>
          </div>

          <!-- Company Section -->
          <div class="footer-section">
            <h3 class="footer-heading">Company</h3>
            <ul class="footer-links">
              <li><a href="/privacy-policy.html">Privacy Policy</a></li>
              <li><a href="/contact.html">Contact Us</a></li>
              <li><a href="/about.html">About</a></li>
            </ul>
          </div>
        </div>

        <!-- Bottom Bar -->
        <div class="footer-bottom">
          <div class="footer-bottom-content">
            <p class="footer-copyright">
              © 2024 ChangeImageTo.com. All rights reserved. Built for speed and quality.
            </p>
          </div>
        </div>
      </div>
    </footer>
</body>
</html>
